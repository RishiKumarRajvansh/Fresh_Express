{% extends 'base_mobile.html' %}
{% load static %}

{% block title %}Payment Successful - Fresh Meat & Seafood{% endblock %}

{% block extra_css %}
<style>
.success-animation {
    width: 100px;
    height: 100px;
    margin: 0 auto 2rem;
    background: linear-gradient(45deg, #28a745, #20c997);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
    }
    70% {
        transform: scale(1.1);
        box-shadow: 0 0 0 20px rgba(40, 167, 69, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
    }
}

.success-icon {
    font-size: 3rem;
    color: white;
}

.payment-details {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 2rem 0;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #e9ecef;
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-label {
    color: #6c757d;
    font-weight: 500;
}

.detail-value {
    color: #495057;
    font-weight: 600;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-6 col-lg-4">
            <div class="text-center">
                <!-- Success Animation -->
                <div class="success-animation">
                    <i class="fas fa-check success-icon"></i>
                </div>
                
                <!-- Success Message -->
                <h2 class="text-success mb-3">Payment Successful!</h2>
                <p class="text-muted mb-4">Your payment has been processed successfully. Your order has been confirmed.</p>
                
                <!-- Payment Details -->
                <div class="payment-details">
                    <h5 class="mb-3 text-center">Payment Details</h5>
                    
                    {% if transaction %}
                    <div class="detail-row">
                        <span class="detail-label">Transaction ID:</span>
                        <span class="detail-value">{{ transaction.transaction_id }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span>
                        <span class="detail-value">#{{ transaction.order.id }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Amount Paid:</span>
                        <span class="detail-value">â‚¹{{ amount|default:transaction.amount }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Payment Method:</span>
                        <span class="detail-value">PhonePe</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Date & Time:</span>
                        <span class="detail-value">{{ transaction.completed_at|date:"M d, Y g:i A" }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Action Buttons -->
                <div class="d-grid gap-2">
                    <a href="{% url 'orders:order_tracking' %}" class="btn btn-success btn-lg">
                        <i class="fas fa-truck me-2"></i>Track Your Order
                    </a>
                    
                    <a href="{% url 'core:home' %}" class="btn btn-outline-primary">
                        <i class="fas fa-home me-2"></i>Continue Shopping
                    </a>
                    
                    <a href="{% url 'orders:order_history' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-receipt me-2"></i>View All Orders
                    </a>
                </div>
                
                <!-- Additional Info -->
                <div class="mt-4 p-3 bg-light rounded">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        A confirmation email has been sent to your registered email address.
                        You will receive SMS updates about your order status.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Auto-redirect to order tracking after 10 seconds -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show countdown
    let countdown = 10;
    const countdownEl = document.createElement('div');
    countdownEl.className = 'mt-3 text-center';
    countdownEl.innerHTML = `<small class="text-muted">Redirecting to order tracking in <span id="countdown">${countdown}</span> seconds...</small>`;
    document.querySelector('.container-fluid').appendChild(countdownEl);
    
    const interval = setInterval(() => {
        countdown--;
        document.getElementById('countdown').textContent = countdown;
        
        if (countdown <= 0) {
            clearInterval(interval);
            window.location.href = "{% url 'orders:order_tracking' %}";
        }
    }, 1000);
    
    // Allow user to cancel auto-redirect
    document.addEventListener('click', () => {
        clearInterval(interval);
        countdownEl.remove();
    });
});
</script>
{% endblock %}
