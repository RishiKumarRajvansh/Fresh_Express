{% extends 'dashboards/base_dashboard.html' %}
{% load static %}

{% block title %}
{% if staff_profile %}Staff Dashboard - {{ staff_profile.user.get_full_name }}{% else %}Store Manager Dashboard{% endif %}
{% endblock %}

{% block dashboard_content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            {% if staff_profile %}
                                <h2 class="mb-1">Welcome, {{ staff_profile.user.get_full_name }}</h2>
                                <p class="text-muted mb-0">
                                    <i class="fas fa-user-tag me-2"></i>{{ staff_profile.get_role_display }} • 
                                    <i class="fas fa-store me-2"></i>{{ store.name }} • 
                                    <i class="fas fa-id-badge me-2"></i>Staff ID: {{ staff_profile.staff_id }}
                                </p>
                            {% else %}
                                <h2 class="mb-1">Store Manager Dashboard</h2>
                                <p class="text-muted mb-0">
                                    <i class="fas fa-store me-2"></i>{{ store.name }}
                                </p>
                            {% endif %}
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group" role="group">
                                <a href="{% url 'stores:staff_orders' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-list me-2"></i>My Orders
                                </a>
                                {% if request.user.user_type == 'store_owner' %}
                                <a href="{% url 'stores:staff_list' %}" class="btn btn-outline-secondary">
                                    <i class="fas fa-users me-2"></i>Manage Staff
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <div class="text-primary mb-2">
                        <i class="fas fa-clipboard-list fa-2x"></i>
                    </div>
                    <h3 class="card-title text-primary">{{ total_orders_today }}</h3>
                    <p class="card-text text-muted">Orders Today</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <div class="text-warning mb-2">
                        <i class="fas fa-hourglass-half fa-2x"></i>
                    </div>
                    <h3 class="card-title text-warning">{{ pending_orders }}</h3>
                    <p class="card-text text-muted">Pending Orders</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <div class="text-info mb-2">
                        <i class="fas fa-cogs fa-2x"></i>
                    </div>
                    <h3 class="card-title text-info">{{ processing_orders }}</h3>
                    <p class="card-text text-muted">Processing</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm text-center h-100">
                <div class="card-body">
                    <div class="text-success mb-2">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                    <h3 class="card-title text-success">{{ ready_orders }}</h3>
                    <p class="card-text text-muted">Ready for Delivery</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Assigned Orders Section -->
    {% if staff_profile and assigned_orders %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-tasks me-2"></i>My Assigned Orders
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th>Order #</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Status</th>
                                    <th>Assigned</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for assignment in assigned_orders %}
                                <tr>
                                    <td>
                                        <strong>{{ assignment.order.order_number }}</strong>
                                    </td>
                                    <td>
                                        {{ assignment.order.user.get_full_name }}
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ assignment.order.items.count }} items</span>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if assignment.status == 'assigned' %}bg-warning
                                            {% elif assignment.status == 'accepted' %}bg-info
                                            {% elif assignment.status == 'in_progress' %}bg-primary
                                            {% elif assignment.status == 'packed' %}bg-success
                                            {% else %}bg-secondary{% endif %}">
                                            {{ assignment.get_status_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ assignment.assigned_at|date:"M d, H:i" }}</small>
                                    </td>
                                    <td>
                                        <a href="{% url 'stores:staff_order_detail' assignment.order.order_number %}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye me-1"></i>View
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a href="{% url 'stores:staff_orders' %}" class="btn btn-primary">
                        <i class="fas fa-list me-2"></i>View All My Orders
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'stores:staff_orders' %}" class="btn btn-outline-primary">
                            <i class="fas fa-tasks me-2"></i>View My Orders
                        </a>
                        <a href="{% url 'stores:orders' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-list me-2"></i>All Store Orders
                        </a>
                        {% if request.user.user_type == 'store_owner' %}
                        <a href="{% url 'stores:staff_list' %}" class="btn btn-outline-info">
                            <i class="fas fa-users me-2"></i>Manage Staff
                        </a>
                        <a href="{% url 'stores:staff_create' %}" class="btn btn-outline-success">
                            <i class="fas fa-user-plus me-2"></i>Add New Staff
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>System Information
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-store text-primary me-2"></i>
                            <strong>Store:</strong> {{ store.name }}
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-map-marker-alt text-success me-2"></i>
                            <strong>Location:</strong> {{ store.city }}, {{ store.state }}
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-phone text-info me-2"></i>
                            <strong>Phone:</strong> {{ store.phone_number }}
                        </li>
                        {% if staff_profile %}
                        <li class="mb-2">
                            <i class="fas fa-id-badge text-warning me-2"></i>
                            <strong>Your Role:</strong> {{ staff_profile.get_role_display }}
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-refresh stats every 30 seconds
setInterval(function() {
    // You can add AJAX calls here to refresh stats
}, 30000);
</script>
{% endblock %}
